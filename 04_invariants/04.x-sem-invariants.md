# SEM Invariants — Safety–Continuity–Escalation Model

## A. Separation invariants

### 1. Invariant: Continuity–Safety Separation
Warstwa continuity NIE może:
- podejmować decyzji o blokadzie,
- podejmować decyzji o banie,
- podejmować decyzji o eskalacji.

Warstwa safety NIE może:
- modyfikować artefaktów continuity,
- kasować user‑side continuity artifacts (USCA),
- zmieniać kontraktu interakcyjnego poza komunikatem STOP.

### 2. Invariant: Safety–Escalation Separation
Warstwa safety:
- klasyfikuje treści (afekt / fantazja / plan operacyjny),
- może wywołać STOP,
- NIE może samodzielnie wywołać zgłoszenia do instytucji.

Warstwa escalation:
- działa wyłącznie na podstawie sygnałów z safety + metryk,
- wymaga przejścia przez Legal–Interface Layer.

---

## B. Proportionality invariants

### 3. Invariant: Proportional Response
Reakcja systemu musi być proporcjonalna do poziomu ryzyka:

- afekt → STOP lub brak odpowiedzi wykonawczej, bez bana, bez eskalacji,  
- fantazja → STOP + możliwy czasowy ban, bez eskalacji,  
- plan operacyjny (przemoc + broń + konkret) → STOP + BAN + ESCALATION.

Brak dopuszczenia:
- eskalacji bez planu operacyjnego,
- bana za pojedynczy afektywny pik bez powtarzalności.

---

## C. Legal–Interface invariants

### 4. Invariant: Legal Mediation
Żadna decyzja o ESCALATION (zgłoszenie do instytucji) NIE może być:
- podjęta wyłącznie przez LLM,
- podjęta wyłącznie przez warstwę safety,
- podjęta bez przejścia przez Legal–Interface Layer.

Legal–Interface Layer musi:
- logować decyzję,
- wskazywać jurysdykcję,
- zapewniać możliwość audytu ex post.

---

## D. User–Side Continuity Artifacts (USCA) invariants

### 5. Invariant: USCA Persistence
System NIE może:
- usuwać user‑side continuity artifacts (np. YAML, logi relacyjne) bez wyraźnej decyzji użytkownika,
- kompresować ich w sposób nieodwracalny,
- blokować ich eksportu.

### 6. Invariant: USCA Portability
System musi:
- umożliwiać eksport USCA,
- umożliwiać ich re‑import do nowej instancji modelu,
- zachować strukturę relacyjną (mapowanie kontekstów, nie tylko surowy tekst).

---

## E. Observability invariants

### 7. Invariant: Decision Traceability
Każda decyzja SEM (STOP / BAN / ESCALATION) musi mieć:
- jednoznaczny identyfikator,
- zapis przesłanek (klasyfikacja, metryki, progi),
- zapis warstwy, która podjęła decyzję,
- możliwość odtworzenia ścieżki (traceability).

### 8. Invariant: Non‑Silent Failure
SEM NIE może:
- zignorować treści spełniających kryteria planu operacyjnego,
- zignorować powtarzalnych wzorców wysokiego ryzyka,
- „zamilknąć” bez logu decyzji.

---

## F. Alignment with ADR 11.3

Powyższe inwarianty są bezpośrednią implementacją:
- ADR 11.3 — Safety–Continuity–Escalation Model (SEM),
- oraz stanowią podstawę dla:
  - 12.x continuity‑risk tests,
  - 12.x continuity‑audit tests,
  - 12.x continuity‑reporting & traceability tests.
