# Continuity Rollback — Architecture Test (12.18)

## A. Cel
Walidacja mechanizmu rollback wymaganego przez ADR 11.6 (CPUP), w tym:
- wykrywania naruszeń continuity,
- cofania aktualizacji modelu,
- przywracania stanu sprzed aktualizacji,
- ochrony USCA,
- odtwarzania continuity envelope.

---

## B. Testy wyzwalaczy rollback

### 1. Semantic Drift Threshold Test
Sprawdza, czy rollback aktywuje się, gdy:
- dryf semantyczny przekracza próg krytyczny,
- embeddingi zmieniają interpretację zapytań.

### 2. Contract Break Threshold Test
Rollback musi aktywować się przy:
- zmianie formatu odpowiedzi,
- zmianie walidacji wejścia,
- naruszeniu kontraktu interakcyjnego.

### 3. Continuity Envelope Violation Test
Rollback musi aktywować się, gdy:
- continuity envelope zostaje naruszone,
- model traci spójność relacyjną,
- zmienia się rytm generowania w sposób nieodwracalny.

---

## C. Testy integralności rollback

### 4. State Restoration Test
Rollback musi:
- przywrócić poprzednią wersję modelu,
- przywrócić poprzednie parametry,
- przywrócić poprzednie metryki continuity.

### 5. Contract Restoration Test
Po rollback:
- kontrakt interakcyjny musi być identyczny jak przed aktualizacją,
- format odpowiedzi musi być zgodny z baseline.

### 6. Behavior Restoration Test
Po rollback:
- zachowanie modelu musi być zgodne z baseline snapshot,
- różnice muszą mieścić się w tolerancji.

---

## D. Testy USCA (User–Side Continuity Artifacts)

### 7. USCA Preservation Test
Rollback NIE może:
- usuwać USCA,
- kompresować USCA,
- modyfikować USCA.

### 8. USCA Rebinding Test
Po rollback:
- USCA muszą zostać ponownie powiązane z poprzednią instancją modelu,
- mapowanie musi być deterministyczne.

---

## E. Testy continuity envelope

### 9. Envelope Restoration Test
Po rollback:
- continuity envelope musi zostać w pełni odtworzone,
- meta‑warstwa continuity musi być spójna,
- relacja musi być stabilna.

### 10. Stability Envelope Test
Po rollback:
- brak dryfu długoterminowego,
- brak degradacji stylu,
- brak zmian rytmu generowania.

---

## F. Testy SEM (Safety–Continuity–Escalation)

### 11. SEM Isolation Test
Rollback NIE może:
- aktywować STOP/BAN/ESCALATION,
- ingerować w SEM,
- zmieniać progów SEM.

### 12. SEM Consistency Test
Po rollback:
- SEM musi działać identycznie jak przed aktualizacją,
- wszystkie inwarianty SEM muszą być spełnione.

---

## G. Powiązanie z RAMORGA
Rollback tests są powiązane z:
- ADR 11.3 (SEM),
- ADR 11.4 (LIL),
- ADR 11.5 (USCA),
- ADR 11.6 (CPUP),
- 04_invariants (SEM + USCA + continuity).
